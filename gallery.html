<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gallery | La Casa de Cartón</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
</head>
  
<body>
  <div class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">La Casa de Cartón</a>
      <div class="nav-links">
        <a href="gallery.html">Gallery</a>
        <a href="#">Services</a>
        <a href="contact.html">Contact Us</a>
      </div>
    </div>
  </div>

<section class="section">
  <main class="main">
    <div class="theme-selector" style="margin-bottom: 40px;">
      <label for="themeDropdown">Select a Theme:</label>
      <select id="themeDropdown" onchange="filterByTheme()">
        <option value="all">All</option>
        <option value="valentines">Valentine’s Day</option>
        <option value="graduation">Graduation</option>
        <option value="misc">Misc</option>
        <option value="signs">Signs</option>
        <option value="backdrops">Backdrops</option>
        <option value="mosaic">Mosaic Structures</option>
        <option value="minis">Minis</option>
        <option value="tablebases">Table Bases</option>
      </select>
    </div>

  <div class="gallery-container">
    <div class="main-image">
      <button class="arrow left" onclick="prevImage()"><i class="fas fa-chevron-left"></i></button>
      <img id="mainDisplay" src="carton1.jpg" alt="Main Display" />
      <button class="arrow right" onclick="nextImage()"><i class="fas fa-chevron-right"></i></button>
    </div>
    <div class="image-description" id="imageDescription">
      <strong>Valentine’s Day Box</strong> (2024)<br>Large Heart Design – Red, Pink & White
    </div>
    <div class="thumbnail-wrapper">
      <div class="thumbnail-row" id="thumbnails">
        <img src="assets/images/valentines/big-love.jpg" alt="LOVE in big brown letters" onclick="setImage(0)" />
        <img src="assets/images/valentines/box-of-chocolates.jpg" alt="Graduation Sign" onclick="setImage(1)" />
        <img src="assets/images/valentines/boy-or-girl-heart.jpg" alt="Mini Display" onclick="setImage(2)" />
        <img src="assets/images/valentines/combi.jpg" alt="Mosaic for Balloons" onclick="setImage(3)" />
        <img src="assets/images/valentines/heart-arch.jpg" alt="Table Base" onclick="setImage(4)" />
        <img src="assets/images/valentines/hollow-heart.jpg" alt="Table Base" onclick="setImage(5)" />
        <img src="assets/images/valentines/huge-box-of-chocolates.jpg" alt="Table Base" onclick="setImage(6)" />
        <img src="assets/images/valentines/i-love-you-brown.jpg" alt="Table Base" onclick="setImage(7)" />
        <img src="assets/images/valentines/i-love-you-white.jpg" alt="Table Base" onclick="setImage(8)" />
        <img src="assets/images/valentines/kisses-booth.jpg" alt="Table Base" onclick="setImage(9)" />
        <img src="assets/images/valentines/love.jpg" alt="Table Base" onclick="setImage(10)" />
        <img src="assets/images/valentines/love-big-heart.jpg" alt="Table Base" onclick="setImage(11)" />
        <img src="assets/images/valentines/love-brown.jpg" alt="Table Base" onclick="setImage(12)" />
        <img src="assets/images/valentines/love-small-hearts.jpg" alt="Table Base" onclick="setImage(13)" />
        <img src="assets/images/valentines/napkin heart.jpg" alt="Table Base" onclick="setImage(14)" />
        <img src="assets/images/valentines/red-truck.jpg" alt="Table Base" onclick="setImage(15)" />
        <img src="assets/images/valentines/small-love-box.jpg" alt="Table Base" onclick="setImage(16)" />
        <img src="assets/images/valentines/teddy-bears.jpg" alt="Table Base" onclick="setImage(17)" />
        <img src="assets/images/valentines/tiny-love-box.jpg" alt="Table Base" onclick="setImage(18)" />
        <img src="assets/images/valentines/white-love.jpg" alt="Table Base" onclick="setImage(19)" />
        <img src="assets/images/valentines/wonky-love.jpg" alt="Table Base" onclick="setImage(20)" />
        <img src="assets/images/valentines/xoxo.jpg" alt="Table Base" onclick="setImage(21)" />
        <!-- <img src="assets/images/theme/name.jpg" alt="Table Base" onclick="setImage(num)" /> -->
        <!-- Add more below as needed -->
      </div>
    </div>
  </div>

  <!-- Message popup -->
  <div id="messagePopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); z-index:999;">
    <div style="background:#fff; padding:20px; max-width:300px; margin:15% auto; border-radius:10px; text-align:center; position:relative;">
      <h3>Message Us</h3>
      <p>Choose your preferred method:</p>
      <a href="https://wa.me/12816908934" target="_blank" style="display:block; margin:10px 0; color:white; background:#25D366; padding:10px; border-radius:5px; text-decoration:none;">WhatsApp</a>
      <a href="sms:+12816908934" style="display:block; margin:10px 0; color:white; background:#007AFF; padding:10px; border-radius:5px; text-decoration:none;">Text Message</a>
      <button onclick="closeMessagePopup()" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:18px; cursor:pointer;">&times;</button>
    </div>
  </div>

    <div id="developerPanel" style="display:none;" class="dev-upload">
    <h3>Developer Upload Mode</h3>

    <label for="themeSelect">Select a Theme:</label>
    <select id="themeSelect">
      <option value="valentines">Valentine’s Day</option>
      <option value="graduation">Graduation</option>
      <option value="misc">Misc</option>
      <option value="signs">Signs</option>
      <option value="backdrops">Backdrops</option>
      <option value="mosaic">Mosaic Structures</option>
      <option value="minis">Minis</option>
      <option value="tablebases">Table Bases</option>
    </select>

    <br><br>
    <input type="file" id="fileInput" accept="image/*,video/*" multiple />
    <button onclick="handleUploads()">Upload</button>

    <p style="font-size: 14px; color: #888;">Preview only – not saved permanently.</p>
    <div id="uploadPreview"></div>
    </div>
  </main>
</section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="copyright">&copy; 2025 La Casa de Cartón</div>
      <div class="social-icons">
        <a href="mailto:lacasadecarton23@gmail.com" target="_blank" aria-label="Email"><i class="fas fa-envelope"></i></a>
        <a href="https://www.instagram.com/lacasadecarton23/" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://www.facebook.com/lacasadecarton23" target="_blank"><i class="fab fa-facebook fa-lg"></i></a>
        <button onclick="openMessagePopup()" aria-label="Message Options"><i class="fas fa-comment-dots"></i></button>
      </div>
    </div>
  </footer>
  

  
  <!-- Gallery script -->
  <script>
    let allImages = [];
    let current = 0;

    async function loadGalleryData() {
      const res = await fetch("assets/data/gallery.json");
      const data = await res.json();
      allImages = data;
      renderThumbnails("all");
      setImage(0);
    }

    function renderThumbnails(theme) {
      const container = document.getElementById("thumbnails");
      container.innerHTML = "";

      const filtered = theme === "all"
        ? Array.from(new Map(allImages.map(item => [item.src, item])).values())
        : allImages.filter(img => img.themes.includes(theme));

      filtered.forEach((img, index) => {
        const thumb = document.createElement("img");
        thumb.loading = "lazy";
        thumb.src = img.src;
        thumb.alt = img.name;
        
        // Set image on click
        thumb.onclick = () => setImageFromFiltered(index, theme);
        
        // Fallback if image fails to load
        thumb.onerror = () => {
          thumb.src = 'assets/images/fallback.jpg';
        };
        
        // Preload full-size image on hover
        thumb.onmouseenter = () => {
          const preload = new Image();
          preload.src = img.src;
        };

        container.appendChild(thumb);
      });

      if (filtered.length > 0) {
        current = 0;
        updateMainDisplay(filtered[0]);
      }
    }

    function setImageFromFiltered(index, theme) {
      const filtered = theme === "all"
        ? Array.from(new Map(allImages.map(item => [item.src, item])).values())
        : allImages.filter(img => img.themes.includes(theme));

      current = index;
      updateMainDisplay(filtered[index]);
      highlightThumbnail(index);
    }

    function updateMainDisplay(img) {
      document.getElementById("mainDisplay").src = img.src;
      document.getElementById("imageDescription").innerHTML = `
        <strong>${img.name}</strong> (${img.year})<br>${img.size} – ${img.medium}
      `;
    }

    function highlightThumbnail(index) {
      const thumbnails = document.getElementById("thumbnails").getElementsByTagName("img");
      for (let i = 0; i < thumbnails.length; i++) {
        thumbnails[i].classList.remove("active");
      }
      if (thumbnails[index]) thumbnails[index].classList.add("active");
    }

    function filterByTheme() {
      const dropdown = document.getElementById("themeDropdown");
      const selectedTheme = dropdown.value;

      localStorage.setItem("lastTheme", selectedTheme);
      renderThumbnails(selectedTheme);

      // Remove focus from the dropdown to prevent arrow key hijacking
      dropdown.blur();
    }
    
    document.addEventListener("keydown", (e) => {
      const activeElement = document.activeElement;
      if (activeElement.tagName === "INPUT" || activeElement.tagName === "SELECT" || activeElement.tagName === "TEXTAREA") {
        return; // Don't interfere with form controls
      }
      
      const thumbnails = document.getElementById("thumbnails").getElementsByTagName("img");
      const selectedTheme = document.getElementById("themeDropdown").value;
      const filtered = selectedTheme === "all"
        ? Array.from(new Map(allImages.map(item => [item.src, item])).values())
        : allImages.filter(img => img.themes.includes(selectedTheme));

      if (e.key === "ArrowRight") {
        current = (current + 1) % filtered.length;
        updateMainDisplay(filtered[current]);
        highlightThumbnail(current);
      } else if (e.key === "ArrowLeft") {
        current = (current - 1 + filtered.length) % filtered.length;
        updateMainDisplay(filtered[current]);
        highlightThumbnail(current);
      }
    });

    function prevImage() {
      const selectedTheme = document.getElementById("themeDropdown").value;
      const filtered = selectedTheme === "all"
        ? Array.from(new Map(allImages.map(item => [item.src, item])).values())
        : allImages.filter(img => img.themes.includes(selectedTheme));

      current = (current - 1 + filtered.length) % filtered.length;
      updateMainDisplay(filtered[current]);
      highlightThumbnail(current);
    }

    function nextImage() {
      const selectedTheme = document.getElementById("themeDropdown").value;
      const filtered = selectedTheme === "all"
        ? Array.from(new Map(allImages.map(item => [item.src, item])).values())
        : allImages.filter(img => img.themes.includes(selectedTheme));

      current = (current + 1) % filtered.length;
      updateMainDisplay(filtered[current]);
      highlightThumbnail(current);
    }
    
    window.addEventListener("load", () => {
      loadGalleryData().then(() => {
        const lastTheme = localStorage.getItem("lastTheme") || "all";
        document.getElementById("themeDropdown").value = lastTheme;
        renderThumbnails(lastTheme);
      });
    });
    
  </script>
</body></html>
